<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Formulário de Inscrição</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --font-family: 'Open Sans', sans-serif;
      --font-size-body: 14px;
      --font-weight-bold: 600;
      --color-background: #BE99DF;
      --color-card-bg: #fff;
      --color-card-border: #dbdfe7;
      --color-card-shadow: rgba(99, 77, 255, .06);
      --color-header: #525356;
      --color-label: #5C3875;
      --color-input-text: #71747A;
      --color-input-border: #dbdfe7;
      --color-focus-border: rgb(90, 76, 194);
      --color-submit-btn-bg: #5C3875;
      --color-submit-btn-text: #fff;
    }
    body {
      background: var(--color-background);
      font-family: var(--font-family);
      font-size: var(--font-size-body);
      color: var(--color-input-text);
    }
    .card {
      background: var(--color-card-bg);
      border: 1px solid var(--color-card-border);
      border-radius: 8px;
      box-shadow: 0 4px 16px var(--color-card-shadow);
      padding: 24px;
      margin-bottom: 16px;
    }
    label {
      color: var(--color-label);
      font-weight: var(--font-weight-bold);
    }
    h1, h2, .section-title {
      color: var(--color-header);
    }
    .section-title {
      font-size: 20px;
      margin-top: 24px;
      text-align: center;
    }
    .form-control, .form-select {
      border: 1px solid var(--color-input-border);
      border-radius: 6px;
      padding: 12px;
      font-size: 14px;
      color: var(--color-input-text);
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--color-focus-border);
      box-shadow: none;
    }
    .btn-submit {
      background: var(--color-submit-btn-bg);
      color: var(--color-submit-btn-text);
      height: 48px;
      border-radius: 6px;
      font-weight: var(--font-weight-bold);
    }
    .form-check-label {
      white-space: nowrap;
    }
    .settings-panel {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
    }
    .settings-panel label {
      font-size: 13px;
      margin-bottom: 2px;
      color: #525356;
    }
    .settings-panel input[type="color"] {
      width: 60px;
      height: 30px;
      border: 1px solid #ddd;
      cursor: pointer;
      padding: 0;
    }
    .settings-panel select {
      width: 150px;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="settings-panel">
    <div>
      <label for="bgColorPicker">Fundo:</label>
      <input type="color" id="bgColorPicker" value="#BE99DF" />
    </div>
    <div>
      <label for="labelColorPicker">Rótulos/Botão:</label>
      <input type="color" id="labelColorPicker" value="#5C3875" />
    </div>
    <div>
      <label for="textColorPicker">Textos Gerais:</label>
      <input type="color" id="textColorPicker" value="#525356" />
    </div>
    <div>
      <label for="fontFamilySelector">Fonte:</label>
      <select id="fontFamilySelector">
        <option value="'Open Sans', sans-serif">Open Sans (Padrão)</option>
        <option value="'Roboto', sans-serif">Roboto</option>
        <option value="'Montserrat', sans-serif">Montserrat</option>
        <option value="'Lato', sans-serif">Lato</option>
        <option value="'BR Omny', sans-serif">BR Omny (oficial da PCR)</option>
      </select>
    </div>
  </div>

  <div class="container mt-4">
      <div class="text-center">
          <img src="https://statics.recife.pe.gov.br/images/dynamics/semul/recife-das-mulheres.png?w=400"
               alt="Recife das Mulheres" class="img-fluid" style="max-width:400px;">
      </div>
      <div class="card mt-4">
          <h1 class="text-center">SECRETARIA DA MULHER DO RECIFE</h1>
          <h2 class="text-center">Formulário de Inscrição</h2>
          <form id="formInscricao">
              <div class="mb-3">
                  <label for="tipodeinscricao" class="form-label">Tipo de Inscrição</label>
                  <select id="tipodeinscricao" name="tipodeinscricao" class="form-select" required>
                      <option value="">Selecione</option>
                      <option value="Centro Marta Almeida">Cursos Profissionalizantes - Centro Marta Almeida</option>
                      <option value="Rede de Artesãs">Rede de Artesãs</option>
                      <option value="Tá com Elas">Tá com Elas</option>
                  </select>
              </div>
              <h2 class="section-title">1 - Dados Pessoais</h2>
              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label for="cpf" class="form-label">CPF</label>
                      <input type="text" id="cpf" name="cpf" class="form-control" placeholder="___.___.___-__" maxlength="14" value="{{ $json.preferred_username }}">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label for="datanasc" class="form-label">Data de nascimento</label>
                      <input type="text" id="datanasc" name="datanasc" class="form-control" placeholder="dd/mm/aaaa" value="{{ $json.result.datanasc }}">
                  </div>
              </div>
              <div class="mb-3">
                  <label for="nome" class="form-label">Nome completo (conforme RG)</label>
                  <input type="text" id="nome" name="nome" class="form-control" value="{{ $json.dob }}">
              </div>
              <div class="mb-3">
                  <label for="rg" class="form-label">RG</label>
                  <input type="text" id="rg" name="rg" class="form-control">
              </div>
              <div class="mb-3">
                  <label for="nomesocial" class="form-label">Nome social</label>
                  <input type="text" id="nomesocial" name="nomesocial" class="form-control">
              </div>
              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label for="telefone" class="form-label">Telefone</label>
                      <input type="text" id="telefone" name="telefone" class="form-control" placeholder="(##) #####-####" value="{{ $json.telefone }}">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label class="form-label">É WhatsApp?</label>
                      <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="whatsapp" value="Sim"><label class="form-check-label">Sim</label>
                      </div>
                      <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="whatsapp" value="Não"><label class="form-check-label">Não</label>
                      </div>
                  </div>
              </div>
              <div class="mb-3">
                  <label for="telefone2" class="form-label">Telefone 2</label>
                  <input type="text" id="telefone2" name="telefone2" class="form-control" placeholder="(##) #####-####">
              </div>
              <div class="mb-3">
                  <label for="email" class="form-label">E-mail</label>
                  <input type="email" id="email" name="email" class="form-control" placeholder="exemplo@dominio.com" value="{{ $json.email }}">
              </div>
              <div class="mb-3">
                  <label for="etnia" class="form-label">Etnia</label>
                  <select id="etnia" name="etnia" class="form-select">
                      <option value="">Selecione</option>
                      <option value="Preta">Preta</option>
                      <option value="Parda">Parda</option>
                      <option value="Branca">Branca</option>
                      <option value="Indígena">Indígena</option>
                      <option value="Amarela">Amarela</option>
                      <option value="Outra">Outra</option>
                  </select>
              </div>
              <div class="mb-3">
                  <label for="genero" class="form-label">Identidade de gênero</label>
                  <select id="genero" name="genero" class="form-select">
                      <option value="">Selecione</option>
                      <option value="Mulher Cis">Mulher Cis</option>
                      <option value="Mulher Trans">Mulher Trans</option>
                      <option value="Não binário">Não binário</option>
                      <option value="Prefiro não responder">Prefiro não responder</option>
                  </select>
              </div>
              <div class="mb-3">
                  <label class="form-label">Você se identifica como pessoa com deficiência?</label>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="pcd" id="pcdSim" value="Sim" required><label class="form-check-label" for="pcdSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="pcd" id="pcdNao" value="Não"><label class="form-check-label" for="pcdNao">Não</label>
                  </div>
              </div>
              <div class="mb-3" id="divCategoriaPCD" style="display:none;">
                  <label for="categoriasepcd" class="form-label">Categoria (se PCD)</label>
                  <select id="categoriasepcd" name="categoriasepcd" class="form-select">
                      <option value="">Selecione a categoria</option>
                      <option value="Deficiência Física">Deficiência Física</option>
                      <option value="Deficiência Auditiva">Deficiência Auditiva</option>
                      <option value="Deficiência Visual">Deficiência Visual</option>
                      <option value="Deficiência Intelectual">Deficiência Intelectual</option>
                      <option value="Deficiência Psicossocial">Deficiência Psicossocial</option>
                      <option value="Deficiências Múltiplas">Deficiências Múltiplas</option>
                  </select>
              </div>
              <div class="mb-3" id="divDeficienciaPCD" style="display:none;">
                  <label for="deficiencia" class="form-label">Deficiência</label>
                  <select id="deficiencia" name="deficiencia" class="form-select">
                      <option value="">Selecione (caso tenha deficiência)</option>
                  </select>
              </div>
              <div class="mb-3">
                  <label class="form-label">Recebe algum benefício do governo?</label>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="recebebeneficio" value="Sim" id="beneficioSim" required>
                      <label class="form-check-label" for="beneficioSim">Sim</label>
                  </div>
                  <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="recebebeneficio" value="Não" id="beneficioNao">
                      <label class="form-check-label" for="beneficioNao">Não</label>
                  </div>
              </div>
              <div class="mb-3" id="divBeneficios" style="display:none;">
                  <label class="form-label fw-bold">Se sim, quais?</label>
                  <div class="row">
                      <div class="col-md-6">
                          <div class="form-check"><input class="form-check-input" type="checkbox" name="beneficios[]" value="Auxílio-acolhida"><label class="form-check-label">Auxílio-acolhida</label></div>
                          <div class="form-check"><input class="form-check-input" type="checkbox" name="beneficios[]" value="Bolsa Família"><label class="form-check-label">Bolsa Família</label></div>
                          <div class="form-check"><input class="form-check-input" type="checkbox" name="beneficios[]" value="Auxílio Emergencial"><label class="form-check-label">Auxílio Emergencial</label></div>
                          <div class="form-check"><input class="form-check-input" type="checkbox" name="beneficios[]" value="Benefício de Prestação Continuada (BPC)"><label class="form-check-label">Benefício de Prestação Continuada (BPC)</label></div>
                      </div>
                      <div class="col-md-6">
                          <div class="form-check"><input class="form-check-input" type="checkbox" name="beneficios[]" value="Programa de Erradicação do Trabalho Infantil (PETI)"><label class="form-check-label">Programa de Erradicação do Trabalho Infantil (PETI)</label></div>
                          <div class="form-check"><input class="form-check-input" type="checkbox" name="beneficios[]" value="Garantia-Safra e Seguro-Defeso (ou Pescador Artesanal)"><label class="form-check-label">Garantia-Safra e Seguro-Defeso...</label></div>
                          <div class="form-check"><input class="form-check-input" type="checkbox" name="beneficios[]" value="Auxílio-Reclusão"><label class="form-check-label">Auxílio-Reclusão</label></div>
                      </div>
                  </div>
              </div>
              <div class="mb-3">
                  <label for="escolaridade" class="form-label">Escolaridade</label>
                  <select id="escolaridade" name="escolaridade" class="form-select">
                      <option value="">Selecione</option>
                      <option value="Ensino fundamental incompleto">Ensino fundamental incompleto</option>
                      <option value="Ensino fundamental completo">Ensino fundamental completo</option>
                      <option value="Ensino médio incompleto">Ensino médio incompleto</option>
                      <option value="Ensino médio completo">Ensino médio completo</option>
                      <option value="Ensino superior incompleto">Ensino superior incompleto</option>
                      <option value="Ensino superior completo">Ensino superior completo</option>
                      <option value="Pós-graduação">Pós-graduação</option>
                  </select>
              </div>
              <div class="row">
                  <div class="col-md-6 mb-3">
                      <label for="quantosfilhos" class="form-label">Quantos filhos</label>
                      <input type="number" id="quantosfilhos" name="quantosfilhos" class="form-control" min="0">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label for="habitantes" class="form-label">Número de habitantes na residência</label>
                      <input type="number" id="habitantes" name="habitantes" class="form-control" min="0">
                  </div>
              </div>
              <div class="mb-3">
                  <label for="rendamensal" class="form-label">Qual renda domiciliar total?</label>
                  <select id="rendamensal" name="rendamensal" class="form-select">
                      <option value="">Selecione</option>
                      <option value="Até 1 salário mínimo">Até 1 salário mínimo</option>
                      <option value="Até 2 salários mínimos">Até 2 salários mínimos</option>
                      <option value="Até 5 salários mínimos">Até 5 salários mínimos</option>
                      <option value="Até 10 salários mínimos">Até 10 salários mínimos</option>
                      <option value="Mais de 10 salários mínimos">Mais de 10 salários mínimos</option>
                  </select>
              </div>
              <div class="mb-3">
                  <label for="rendaquecontribu" class="form-label">Renda que contribui</label>
                  <select id="rendaquecontribu" name="rendaquecontribu" class="form-select">
                      <option value="">Selecione</option>
                      <option value="Até 1 salário mínimo">Até 1 salário mínimo</option>
                      <option value="Até 2 salários mínimos">Até 2 salários mínimos</option>
                      <option value="Até 5 salários mínimos">Até 5 salários mínimos</option>
                      <option value="Até 10 salários mínimos">Até 10 salários mínimos</option>
                      <option value="Mais de 10 salários mínimos">Mais de 10 salários mínimos</option>
                  </select>
              </div>
              <h2 class="section-title">2 - Dados da Residência</h2>
              <div class="row">
                  <div class="col-md-6 mb-3"><label for="cep" class="form-label">CEP</label><input type="text" id="cep" name="cep" class="form-control" placeholder="#####-###" value="{{ $json.postal_code }}"></div>
                  <div class="col-md-6 mb-3"><label for="logradouro" class="form-label">Logradouro</label><input type="text" id="logradouro" name="logradouro" class="form-control" value="{{ $json.addressStreet }}"></div>
              </div>
              <div class="row">
                  <div class="col-md-6 mb-3"><label for="numero" class="form-label">Número</label><input type="text" id="numero" name="numero" class="form-control" value="{{ $json.addressNumber }}"></div>
                  <div class="col-md-6 mb-3"><label for="complemento" class="form-label">Complemento</label><input type="text" id="complemento" name="complemento" class="form-control" value="{{ $json.addressComplement }}"></div>
              </div>
              <div class="mb-3"><label for="bairro" class="form-label">Bairro</label><input type="text" id="bairro" name="bairro" class="form-control" value="{{ $json.neighborhood }}"></div>
              <div class="mb-3"><label for="comprovres" class="form-label">Comprovante de residência</label><input type="file" id="comprovres" name="comprovres" class="form-control" accept=".pdf,.jpg,.jpeg,.png,.heic"></div>
              <div id="divEndNegocio" style="display: none;">
                  <div class="mb-3 form-check">
                      <input type="checkbox" id="endnegocio" name="endnegocio" class="form-check-input">
                      <label for="endnegocio" class="form-check-label">Endereço é do negócio</label>
                  </div>
              </div>
              <div class="mb-3" id="divLocalMentoria" style="display: none;">
                  <label class="form-label">Local da mentoria</label>
                  <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="localmentoria" value="Sim"><label class="form-check-label">Sim</label></div>
                  <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="localmentoria" value="Não"><label class="form-check-label">Não</label></div>
              </div>
              
              <iframe id="iframeTipoInscricao" style="width:100%;min-height:200px;border:none;transition: height 0.3s;" title="Seção específica"></iframe>

              
              <h2 class="section-title">Cursos</h2>
              <div class="row">
                <div class="mb-3">
                  <label for="areatematica" class="form-label">Área Temática</label>
                  <select id="areatematica" name="areatematica" class="form-select">
                      <option value="">Selecione</option>
                      <option value="audio">Áudio/Visual e Fotografia</option>
                      <option value="moda">Moda e costura</option>
                      <option value="gastronomia">Gastronomia</option>
                      <option value="outros">Outros</option>
                  </select>
                </div>
              <button type="submit" class="btn btn-submit w-100">Enviar</button>
          </form>
          <div id="responseMessage" class="mt-3"></div>
      </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
<script>
window.onload = function() {
    const root = document.documentElement; const bgColorPicker = document.getElementById('bgColorPicker'); const labelColorPicker = document.getElementById('labelColorPicker'); const textColorPicker = document.getElementById('textColorPicker'); const fontFamilySelector = document.getElementById('fontFamilySelector'); const brOmnyRegularBase64 = '{{ $json.BROmnyRegular || "" }}'; const brOmnyBoldBase64 = '{{ $json.BROmnyBold || "" }}'; const safeLocalStorage = { getItem: (key) => { try { return localStorage.getItem(key); } catch { return null; } }, setItem: (key, value) => { try { localStorage.setItem(key, value); } catch {} } };

    function injectBrOmny() { if (document.getElementById('br-omny-style') || !brOmnyRegularBase64) return; const st = document.createElement('style'); st.id = 'br-omny-style'; st.textContent = `@font-face { font-family: 'BR Omny'; src: url('data:font/woff2;base64,${brOmnyRegularBase64}') format('woff2'); font-weight: normal; font-style: normal; font-display: swap; }@font-face { font-family: 'BR Omny'; src: url('data:font/woff2;base64,${brOmnyBoldBase64}') format('woff2'); font-weight: 600; font-style: normal; font-display: swap; }`; document.head.appendChild(st); }
    const applySettings = () => { const bg = safeLocalStorage.getItem('bgColor') || '#BE99DF'; const lbl = safeLocalStorage.getItem('labelColor') || '#5C3875'; const txt = safeLocalStorage.getItem('textColor') || '#525356'; const ff = safeLocalStorage.getItem('fontFamily') || "'Open Sans', sans-serif"; root.style.setProperty('--color-background', bg); root.style.setProperty('--color-label', lbl); root.style.setProperty('--color-submit-btn-bg', lbl); root.style.setProperty('--color-input-text', txt); root.style.setProperty('--color-header', txt); root.style.setProperty('--font-family', ff); bgColorPicker.value = bg; labelColorPicker.value = lbl; textColorPicker.value = txt; fontFamilySelector.value = ff; if (ff.includes('BR Omny')) injectBrOmny(); };
    
    bgColorPicker.addEventListener('input', e => { root.style.setProperty('--color-background', e.target.value); safeLocalStorage.setItem('bgColor', e.target.value); });
    labelColorPicker.addEventListener('input', e => { root.style.setProperty('--color-label', e.target.value); root.style.setProperty('--color-submit-btn-bg', e.target.value); safeLocalStorage.setItem('labelColor', e.target.value); });
    textColorPicker.addEventListener('input', e => { root.style.setProperty('--color-input-text', e.target.value); root.style.setProperty('--color-header', e.target.value); safeLocalStorage.setItem('textColor', e.target.value); });
    fontFamilySelector.addEventListener('change', e => { const ff = e.target.value; root.style.setProperty('--font-family', ff); safeLocalStorage.setItem('fontFamily', ff); if (ff.includes('BR Omny')) injectBrOmny(); });
    
    applySettings();

    const cpf = document.getElementById('cpf'), datanasc = document.getElementById('datanasc'), tel = document.getElementById('telefone'), tel2 = document.getElementById('telefone2'), cep = document.getElementById('cep'), logra = document.getElementById('logradouro'), bairro = document.getElementById('bairro'), catSel = document.getElementById('categoriasepcd'), defSel = document.getElementById('deficiencia'), pcdSim = document.getElementById('pcdSim'), pcdNao = document.getElementById('pcdNao'), divCat = document.getElementById('divCategoriaPCD'), divDef = document.getElementById('divDeficienciaPCD'), renda = document.getElementById('rendamensal'), contrib = document.getElementById('rendaquecontribu'), tipoSel = document.getElementById('tipodeinscricao'), iframe = document.getElementById('iframeTipoInscricao'), form = document.getElementById('formInscricao'), resp = document.getElementById('responseMessage'), fileComp = document.getElementById('comprovres'), beneficioSim = document.getElementById('beneficioSim'), beneficioNao = document.getElementById('beneficioNao'), divBeneficios = document.getElementById('divBeneficios'), divMentoria = document.getElementById('divLocalMentoria'), divEndNegocio = document.getElementById('divEndNegocio'), endNegocioCheck = document.getElementById('endnegocio');

    const aplicarMascaraCPF = v => { let d = v.replace(/\D/g, '').slice(0, 11); return d.replace(/(\d{3})(\d{3})(\d{3})(\d{2})?/, '$1.$2.$3-$4').replace(/[-.]$/, '') };
    const aplicarMascaraData = v => v.replace(/\D/g, '').slice(0, 8).replace(/(\d{2})(\d{2})(\d{4})?/, '$1/$2/$3').replace(/\/$/, '');
    const aplicarMascaraTelefone = v => { let d = v.replace(/\D/g, '').slice(0, 11); return d.replace(/(\d{2})(\d{5})(\d{4})?/, '($1) $2-$3').replace(/[- ]$/, '') };
    const aplicarMascaraCEP = v => v.replace(/\D/g, '').slice(0, 8).replace(/(\d{5})(\d{3})?/, '$1-$2').replace(/-$/, '');
    const blobToBase64 = b => new Promise(r => { const f = new FileReader(); f.onloadend = () => r(f.result.split(',')[1]); f.readAsDataURL(b) });
    const defPorCat = {"Deficiência Física":["Paraplegia (comprometimento total das pernas)","Tetraplegia (comprometimento de braços e pernas)","Hemiplegia (paralisia de um lado do corpo)","Amputações ou ausência congênita de membros","Paralisia cerebral","Má-formação congênita ou adquirida (por traumas, acidentes ou doenças)","Nanismo (estatura muito abaixo da média, podendo acarretar limitações motoras)","Mielomeningocele (espinha bífida)","Sequelas de poliomielite","Distrofia muscular de Duchenne","Esclerose múltipla"],"Deficiência Auditiva":["Perda auditiva leve","Surdez moderada, severa ou profunda","Surdez neurossensorial","Surdez condutiva","Surdez mista","Surdez pré-lingual","Surdez pós-lingual"],"Deficiência Visual":["Baixa visão","Cegueira","Retinopatia diabética","Glaucoma avançado","Degeneração macular","Catarata congênita","Retinose pigmentar","Neuropatia óptica","Albinismo ocular"],"Deficiência Intelectual":["Síndrome de Down","Transtorno do Espectro do Autismo (TEA) com comprometimento cognitivo","Síndrome do X Frágil","Atraso global do desenvolvimento","Microcefalia","Síndrome de Williams","Fenilcetonúria não tratada","Hidrocefalia congênita"],"Deficiência Psicossocial":["Esquizofrenia","Transtorno de Estresse Pós-Traumático (TEPT)","Depressão crônica resistente","Transtorno bipolar grave","Transtorno de Ansiedade Generalizada incapacitante","Transtornos graves de personalidade","Transtorno Obsessivo-Compulsivo severo"],"Deficiências Múltiplas":["Síndrome de Usher","Cegueira + TEA","Surdez + Deficiência Intelectual + Paralisia Cerebral","Cegueira + Síndrome de Down","Surdocegueira","Síndrome de Charge","Surdez + Transtorno Bipolar","Paralisia cerebral + Deficiência Intelectual","Amputações + Surdez","Nanismo + Deficiência Visual"]};
    
    function popularDef(catSel, defSel) { defSel.innerHTML = '<option value="">Selecione (caso tenha deficiência)</option>'; (defPorCat[catSel.value] || []).forEach(txt => { const opt = document.createElement('option'); opt.value = txt; opt.textContent = txt; defSel.appendChild(opt); }); }
    function filtrarRenda(rendaSel, contribSel) { const val = rendaSel.value; const opts = [...contribSel.options]; const idx = opts.findIndex(o => o.value === val); opts.forEach((o, i) => o.style.display = idx === -1 || i === 0 || i <= idx ? '' : 'none'); }
    function togglePCD(radioSim, divCat, divDef, catSel, defSel) { if (radioSim.checked) { divCat.style.display = 'block'; divDef.style.display = 'block'; } else { divCat.style.display = 'none'; divDef.style.display = 'none'; catSel.value = ''; defSel.innerHTML = '<option value="">Selecione (caso tenha deficiência)</option>'; } }
    function toggleBeneficios(radioSim, divBeneficios) { if (radioSim.checked) { divBeneficios.style.display = 'block'; } else { divBeneficios.style.display = 'none'; divBeneficios.querySelectorAll('input[type="checkbox"]').forEach(chk => chk.checked = false); } }
    async function buscarCEP(cepIn, logra, bairro) { const raw = cepIn.value.replace(/\D/g, ''); if (raw.length !== 8) return; try { const d = await fetch(`https://viacep.com.br/ws/${raw}/json/`).then(r => r.json()); if (!d.erro) { logra.value = d.logradouro || ''; bairro.value = d.bairro || ''; } else alert('CEP não encontrado'); } catch {} }
    async function atualizarIframe(sel, iframe, divMentoria, divEndNegocio, endNegocioCheck) { const tipo = sel.value, isTaComElas = tipo === 'Tá com Elas'; divMentoria.style.display = isTaComElas ? 'block' : 'none'; if (!isTaComElas) divMentoria.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false); divEndNegocio.style.display = isTaComElas ? 'block' : 'none'; if (!isTaComElas) endNegocioCheck.checked = false; if (!isTaComElas) { iframe.style.display = 'none'; iframe.src = ''; iframe.style.height = '0px'; return } try { const responseArray = await fetch('https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/carregar-iframe', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ tipodeinscricao: tipo }) }).then(r => r.json()); const responseData = responseArray[0]; const html = responseData.html; iframe.style.display = 'block'; iframe.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(html); if (responseData.height) { iframe.style.height = responseData.height + 'px'; } } catch (e) { iframe.style.display = 'none'; console.error('Falha ao processar resposta do iframe:', e); } }
    async function iniciarEnvio(form, resp, fileInput, iframe) { resp.textContent = 'Coletando dados...'; let base64 = ''; if (fileInput.files.length) { const f = fileInput.files[0]; if (f.size > 25 * 1024 * 1024) { alert('O arquivo excede o limite de 25MB.'); resp.textContent = ''; return; } base64 = await blobToBase64(f); } const fd = new FormData(form); const dadosPai = {}; fd.forEach((value, key) => { if (key.endsWith('[]')) { const cleanKey = key.slice(0, -2); if (!dadosPai[cleanKey]) dadosPai[cleanKey] = []; dadosPai[cleanKey].push(value); } else { dadosPai[key] = value; } }); dadosPai.comprovres_base64 = base64; delete dadosPai.comprovres; if (iframe && iframe.contentWindow && iframe.style.display !== 'none') { resp.textContent = 'Enviando...'; iframe.contentWindow.postMessage({ tipo: 'enviarDados', dadosPai: dadosPai }, '*'); } else { try { const r = await fetch('https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/receber-inscricao', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dadosPai) }).then(r => r.text()); resp.textContent = r; form.reset(); } catch(e) { resp.textContent = 'Erro ao enviar inscrição: ' + e.message; } } }
    
    window.addEventListener('message', (event) => { if (!event.data) return; if (event.data.tipo === 'ajusteAltura') { iframe.style.height = event.data.altura + 'px'; } else if (event.data.tipo === 'envioConcluido') { resp.textContent = event.data.mensagem; if (event.data.status === 'sucesso') { form.reset(); atualizarIframe({value: ''}, iframe, divMentoria, divEndNegocio, endNegocioCheck); } } });

    cpf.addEventListener('input', e => e.target.value = aplicarMascaraCPF(e.target.value));
    datanasc.addEventListener('input', e => e.target.value = aplicarMascaraData(e.target.value));
    tel.addEventListener('input', e => e.target.value = aplicarMascaraTelefone(e.target.value));
    tel2.addEventListener('input', e => e.target.value = aplicarMascaraTelefone(e.target.value));
    cep.addEventListener('input', e => e.target.value = aplicarMascaraCEP(e.target.value));
    cep.addEventListener('blur', () => buscarCEP(cep, logra, bairro));
    catSel.addEventListener('change', () => popularDef(catSel, defSel));
    renda.addEventListener('change', () => filtrarRenda(renda, contrib));
    pcdSim.addEventListener('change', () => togglePCD(pcdSim, divCat, divDef, catSel, defSel));
    pcdNao.addEventListener('change', () => togglePCD(pcdSim, divCat, divDef, catSel, defSel));
    beneficioSim.addEventListener('change', () => toggleBeneficios(beneficioSim, divBeneficios));
    beneficioNao.addEventListener('change', () => toggleBeneficios(beneficioSim, divBeneficios));
    tipoSel.addEventListener('change', () => atualizarIframe(tipoSel, iframe, divMentoria, divEndNegocio, endNegocioCheck));
    form.addEventListener('submit', e => { e.preventDefault(); iniciarEnvio(form, resp, fileComp, iframe); });

    togglePCD(pcdSim, divCat, divDef, catSel, defSel);
    toggleBeneficios(beneficioSim, divBeneficios);
    filtrarRenda(renda, contrib);
    atualizarIframe(tipoSel, iframe, divMentoria, divEndNegocio, endNegocioCheck);
};
</script>
</body>
</html>
